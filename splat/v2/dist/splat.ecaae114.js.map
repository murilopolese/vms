{"version":3,"sources":["splat.js"],"names":["format_matrix","ruleArray","formatted","offsetX","offsetY","length","y","x","hasLowerCase","str","test","Rule","when","then","match","grid","element","votes","givenMatch","_y","_x","symbol","value","name","empty","undefined","toUpperCase","voteCounts","Object","values","voteMatch","indexOf","apply","elements","Element","rules","color","clearGrid","GRID_HEIGHT","GRID_WIDTH","push","i","c","String","fromCharCode","module","exports"],"mappings":"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","file":"splat.ecaae114.js","sourceRoot":"..","sourcesContent":["function format_matrix(ruleArray) {\n  const formatted = [\n    ['.', '.', '.'],\n    ['.', '.', '.'],\n    ['.', '.', '.']\n  ]\n  let offsetX = 0\n  let offsetY = 0\n  if (ruleArray.length < 3) {\n    offsetY = 1\n  }\n  if (ruleArray[0].length < 3) {\n    offsetX = 1\n  }\n\n  for (let y = 0; y < ruleArray.length; y++) {\n    for (let x = 0; x < ruleArray[y].length; x++) {\n      formatted[y+offsetY][x+offsetX] = ruleArray[y][x]\n    }\n  }\n\n  return formatted\n}\n\nfunction hasLowerCase(str) {\n    return (/[a-z]/.test(str));\n}\n\nfunction Rule({ when = [[]], then = [[]] }) {\n  this.when = format_matrix(when)\n  this.then = format_matrix(then)\n\n  this.match = function(grid, x, y) {\n    let element = grid[y][x]\n    let votes = {}\n    // console.log('will try to match rule', this.when)\n    let givenMatch = true\n    for (let _y = 0; _y < 3; _y++) {\n      for (let _x = 0; _x < 3; _x++) {\n        let symbol = this.when[_y][_x]\n        let value = grid[y+_y-1][x+_x-1]\n        switch (symbol) {\n          case '@':\n            if (value.name !== element.name) {\n              givenMatch = false\n            }\n            break\n          case null:\n            // Do nothing\n          case '.':\n            // it could be anything here\n            break\n          case '?':\n            if (value.name === empty.name) {\n              givenMatch = false\n            }\n            break\n          case '_':\n            if (value.name !== empty.name) {\n              givenMatch = false\n            }\n            break\n          default:\n            // Check if it's a vote or a given\n            if (hasLowerCase(symbol)) {\n              if (votes[symbol] === undefined) {\n                votes[symbol] = 0\n              }\n              if (value.name[0] === symbol.toUpperCase()) {\n                votes[symbol] += 1\n              }\n            } else {\n              if (value.name[0] !== symbol) {\n                givenMatch = false\n              }\n            }\n        }\n      }\n    }\n    let voteCounts = Object.values(votes)\n    voteMatch = voteCounts.length == 0 || voteCounts.indexOf(0) === -1\n    return givenMatch && voteMatch\n  }\n\n  this.apply = function(grid, x, y) {\n    let element = grid[y][x]\n    // console.log('applying rule', this.then)\n    for (let _y = 0; _y < 3; _y++) {\n      for (let _x = 0; _x < 3; _x++) {\n        let symbol = this.then[_y][_x]\n        switch (symbol) {\n          case '@':\n            grid[y+_y-1][x+_x-1] = elements[element.name]\n            break\n          case '.':\n          case '?':\n          case null:\n            // Do nothing\n            break\n          case '_':\n              grid[y+_y-1][x+_x-1] = empty\n            break;\n          default:\n            grid[y+_y-1][x+_x-1] = elements[symbol.toUpperCase()]\n        }\n      }\n    }\n    return grid\n  }\n}\n\nfunction Element({ name = '_', rules = [], color = 'white' }) {\n  this.name = name\n  this.rules = rules\n  this.color = color\n}\n\nfunction clearGrid(grid) {\n  if (!grid) grid = []\n  for (let y = 0; y < GRID_HEIGHT; y++) {\n    grid[y] = []\n    for (let x = 0; x < GRID_WIDTH; x++) {\n      grid[y].push(empty)\n    }\n  }\n  return grid\n}\n\nlet empty = new Element({ name: '_'})\nlet elements = {\n  '_': empty\n}\nfor (let i = 65; i < 91; i++) {\n  let c = String.fromCharCode(i)\n  elements[c] = new Element({ name: `${c}` })\n}\n\nconst GRID_WIDTH = 30\nconst GRID_HEIGHT = 30\nlet grid = clearGrid()\n\nmodule.exports = {\n  GRID_WIDTH,\n  GRID_HEIGHT,\n  Rule: Rule,\n  Element: Element,\n  grid: grid,\n  elements: elements,\n  clearGrid: clearGrid\n}\n"]}